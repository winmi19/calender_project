<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Pro-Task Elite v2.0 | å•†ä¸šçº§ç®¡ç†ç»ˆç«¯</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #4f46e5; --bg: #f8fafc; --danger: #ef4444;
            --high: #fee2e2; --high-text: #991b1b;
            --mid: #fef9c3; --mid-text: #854d0e;
            --low: #dcfce7; --low-text: #166534;
        }
        body { font-family: 'Segoe UI', system-ui; background: var(--bg); margin: 0; display: flex; height: 100vh; color: #1e293b; }
        
        /* ä¾§è¾¹å¯¼èˆªæ  (å•†ä¸šæ„Ÿ) */
        .sidebar { width: 240px; background: #fff; border-right: 1px solid #e2e8f0; padding: 20px; display: flex; flex-direction: column; }
        .nav-item { padding: 12px; border-radius: 8px; cursor: pointer; margin-bottom: 5px; transition: 0.2s; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .nav-item:hover { background: #f1f5f9; }
        .nav-active { background: #e0e7ff; color: var(--primary); font-weight: 600; }

        /* ä¸»è§†å£ */
        .viewport { flex: 1; padding: 40px; overflow-y: auto; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .stat-val { font-size: 24px; font-weight: 700; color: var(--primary); }

        /* ä»»åŠ¡å®¹å™¨ */
        .app-container { max-width: 800px; margin: 0 auto; }
        .hidden { display: none !important; }

        /* å¤æ‚è¾“å…¥æ¡† */
        .mega-input { background: white; padding: 20px; border-radius: 16px; border: 1px solid #e2e8f0; margin-bottom: 30px; }
        .input-row { display: flex; gap: 10px; margin-top: 10px; }
        select, input[type="text"] { border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px; outline: none; }
        
        /* ä»»åŠ¡é¡¹ (æ›´ç²¾ç»†çš„è®¾è®¡) */
        .todo-item { 
            background: white; padding: 16px; border-radius: 12px; margin-bottom: 12px;
            display: flex; align-items: center; gap: 15px; border: 1px solid #e2e8f0;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .todo-item:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        /* æ–¹æ ¼å¤é€‰æ¡†é€»è¾‘ */
        .check-box { width: 22px; height: 22px; border: 2px solid #cbd5e1; border-radius: 6px; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        .completed .check-box { background: var(--primary); border-color: var(--primary); }
        .completed .check-box::after { content: 'âœ“'; color: white; font-size: 14px; }
        
        /* å˜ç°å’Œåˆ’çº¿è®¾è®¡ */
        .content-area { flex: 1; }
        .todo-content { font-weight: 500; transition: 0.3s; }
        .completed .todo-content { text-decoration: line-through; color: #94a3b8; }
        
        /* ä¼˜å…ˆçº§æ ‡ç­¾ */
        .badge { font-size: 11px; padding: 2px 8px; border-radius: 20px; font-weight: 600; text-transform: uppercase; }
        .priority-high { background: var(--high); color: var(--high-text); }
        .priority-medium { background: var(--mid); color: var(--mid-text); }
        .priority-low { background: var(--low); color: var(--low-text); }

        .btn-del { color: var(--danger); background: none; border: none; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>

<div id="auth-screen" style="width:100%; min-height:100vh; display:flex; justify-content:center; align-items:center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div style="background:white; padding:40px; border-radius:24px; box-shadow:0 20px 40px rgba(0,0,0,0.2); width:100%; max-width:400px; box-sizing:border-box;">
        
        <div style="text-align:center; margin-bottom:30px;">
            <div style="width:60px; height:60px; background:#e0e7ff; border-radius:16px; display:flex; align-items:center; justify-content:center; margin:0 auto 15px;">
                <span style="font-size:30px;">ğŸš€</span>
            </div>
            <h2 style="margin:0; color:#1e293b; font-size:24px;">ç²¾è‹±ç»ˆç«¯</h2>
            <p style="color:#64748b; font-size:14px; margin-top:8px;">è¯·é€šè¿‡èº«ä»½è®¤è¯ä»¥ç»§ç»­</p>
        </div>

        <div style="display:flex; flex-direction:column; gap:20px;">
            <div style="display:flex; flex-direction:column; gap:8px;">
                <label style="font-size:13px; font-weight:600; color:#475569;">ç®¡ç†é‚®ç®±</label>
                <input type="email" id="email" placeholder="name@company.com" 
                    style="width:100%; padding:12px 16px; border:1.5px solid #e2e8f0; border-radius:10px; font-size:15px; outline:none; box-sizing:border-box;">
            </div>

            <div style="display:flex; flex-direction:column; gap:8px;">
                <label style="font-size:13px; font-weight:600; color:#475569;">è®¿é—®å¯†ç </label>
                <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" 
                    style="width:100%; padding:12px 16px; border:1.5px solid #e2e8f0; border-radius:10px; font-size:15px; outline:none; box-sizing:border-box;">
            </div>

            <button onclick="handleAuth('login')" 
                style="width:100%; background:#4f46e5; color:white; padding:14px; border:none; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer;">
                è®¤è¯ç™»å½•
            </button>
            
            <button onclick="handleAuth('signup')" 
                style="width:100%; background:white; color:#4f46e5; padding:12px; border:1.5px solid #4f46e5; border-radius:12px; font-size:14px; font-weight:600; cursor:pointer;">
                ç”³è¯·æ–°æˆå‘˜è´¦å·
            </button>
        </div>

        <div style="margin-top:30px; padding-top:20px; border-top:1px solid #f1f5f9; text-align:center;">
            <p style="font-size:12px; color:#94a3b8; margin:0;">Pro-Task å®‰å…¨åŠ å¯†é€šé“å·²å»ºç«‹</p>
        </div>
    </div>
</div>

<div id="main-app" class="hidden" style="display:flex; width:100%">
    <nav class="sidebar">
        <div style="font-size:20px; font-weight:800; color:var(--primary); margin-bottom:40px">PRO-TASK v2</div>
        <div class="nav-item nav-active">ğŸ“Š æ‰€æœ‰ä»»åŠ¡</div>
        <div class="nav-item">ğŸ”¥ é«˜ä¼˜å…ˆçº§</div>
        <div class="nav-item">âœ… å·²å®Œæˆ</div>
        <div style="margin-top:auto; font-size:12px; color:#666">
            <span id="user-email"></span><br>
            <a href="#" onclick="handleLogout()" style="color:var(--danger)">æ³¨é”€è¿æ¥</a>
        </div>
    </nav>

    <main class="viewport">
        <div class="dashboard-header">
            <div>
                <h1 style="margin:0">å·¥ä½œå°æ¦‚è§ˆ</h1>
                <p style="color:#64748b; margin:5px 0 0 0">æ¬¢è¿å›æ¥ï¼Œè¿™æ˜¯æ‚¨ä»Šå¤©çš„ä»»åŠ¡æ’å¸ƒã€‚</p>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card"><div style="font-size:12px; color:#64748b">å¾…å¤„ç†</div><div class="stat-val" id="pending-count">0</div></div>
            <div class="stat-card"><div style="font-size:12px; color:#64748b">å®Œæˆç‡</div><div class="stat-val" id="comp-rate">0%</div></div>
            <div class="stat-card"><div style="font-size:12px; color:#64748b">ç³»ç»Ÿå»¶è¿Ÿ</div><div class="stat-val" style="color:#10b981">24ms</div></div>
        </div>

        <div class="app-container">
            <div class="mega-input">
                <input type="text" id="todo-input" placeholder="è¾“å…¥ä»»åŠ¡åç§°..." style="width:100%; font-size:18px; border:none; border-bottom:2px solid #f1f5f9; border-radius:0; padding:10px 0">
                <div class="input-row">
                    <select id="todo-priority">
                        <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                        <option value="medium" selected>ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                        <option value="low">ğŸŸ¢ ä½ä¼˜å…ˆçº§</option>
                    </select>
                    <select id="todo-category">
                        <option value="work">ğŸ’¼ å·¥ä½œ</option>
                        <option value="life">ğŸ  ç”Ÿæ´»</option>
                        <option value="study">ğŸ“š å­¦ä¹ </option>
                    </select>
                    <button onclick="addTask()" style="margin-left:auto; background:var(--primary); color:white; border:none; padding:10px 25px; border-radius:8px; cursor:pointer">éƒ¨ç½²ä»»åŠ¡</button>
                </div>
            </div>

            <div id="todo-list"></div>
        </div>
    </main>
</div>

<script>
    // æ™ºèƒ½è¯†åˆ«ç¯å¢ƒï¼šå¦‚æœæœ‰ Vercel æ³¨å…¥çš„å˜é‡å°±ç”¨ï¼Œæ²¡æœ‰å°±å°è¯•æ‰¾æœ¬åœ°å˜é‡
    // è¿™é‡Œæˆ‘ä»¬ç›´æ¥å®šä¹‰ï¼ŒVercel éƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢æˆ–æŠ¥é”™æç¤º
    window.SUPABASE_CONFIG = {
        url: typeof SUPABASE_URL !== 'undefined' ? SUPABASE_URL : '',
        key: typeof SUPABASE_KEY !== 'undefined' ? SUPABASE_KEY : ''
    };
</script> 

<script>
    
    const _db = supabase.createClient(
    "https://awdiomtehljdtdaphrri.supabase.co", // ç›´æ¥å†™æ­» URL æ˜¯å®‰å…¨çš„ï¼Œå®ƒä¸æ˜¯ç§˜å¯†
    "sb_publishable_CHkntk8b79KM3HPhCi0J_w_ZlVOe4tD" // è¿™ä¸ªæ˜¯ Anon Keyï¼Œä¹Ÿæ˜¯å¯ä»¥å…¬å¼€çš„
    );

    _db.auth.onAuthStateChange((event, session) => {
        const authScreen = document.getElementById('auth-screen');
        const mainApp = document.getElementById('main-app');
        if (session) {
            authScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
            document.getElementById('user-email').innerText = session.user.email;
            fetchTodos();
        } else {
            authScreen.classList.remove('hidden');
            mainApp.classList.add('hidden');
        }
    });

    async function handleAuth(type) {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        try {
            const { error } = type === 'login' 
                ? await _db.auth.signInWithPassword({ email, password })
                : await _db.auth.signUp({ email, password });
            if (error) throw error;
        } catch (e) { alert("ç³»ç»Ÿé”™è¯¯: " + e.message); }
    }

    async function handleLogout() { await _db.auth.signOut(); }

    async function fetchTodos() {
        const { data, error } = await _db.from('todo').select('*').order('created_at', { ascending: false });
        if (error) return console.log(error);

        const list = document.getElementById('todo-list');
        list.innerHTML = "";
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        const total = data.length;
        const completed = data.filter(t => t.is_completed).length;
        document.getElementById('pending-count').innerText = total - completed;
        document.getElementById('comp-rate').innerText = total ? Math.round((completed/total)*100) + '%' : '0%';

        data.forEach(t => {
            const div = document.createElement('div');
            div.className = `todo-item ${t.is_completed ? 'completed' : ''}`;
            div.innerHTML = `
                <div class="check-box" onclick="toggleTask(${t.id}, ${t.is_completed})"></div>
                <div class="content-area">
                    <div class="todo-content">${t.content}</div>
                    <div style="font-size:10px; color:#94a3b8; margin-top:4px">
                        <span class="badge priority-${t.priority}">${t.priority}</span>
                        <span>â€¢</span>
                        <span>${t.category}</span>
                        <span>â€¢</span>
                        <span>${new Date(t.created_at).toLocaleDateString()}</span>
                    </div>
                </div>
                <button class="btn-del" onclick="deleteTask(${t.id})">é‡Šæ”¾èµ„æº</button>
            `;
            list.appendChild(div);
        });
    }

    async function addTask() {
        const content = document.getElementById('todo-input').value;
        const priority = document.getElementById('todo-priority').value;
        const category = document.getElementById('todo-category').value;
        if (!content) return;

        const { error } = await _db.from('todo').insert([{ content, priority, category, is_completed: false }]);
        if (error) alert(error.message);
        else { document.getElementById('todo-input').value = ""; fetchTodos(); }
    }

    async function toggleTask(id, current) {
        await _db.from('todo').update({ is_completed: !current }).eq('id', id);
        fetchTodos();
    }

    async function deleteTask(id) {
        await _db.from('todo').delete().eq('id', id);
        fetchTodos();
    }
</script>
</body>
</html>